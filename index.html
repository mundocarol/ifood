
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Processador de Pedidos iFood</title>
<style type="text/css">
:root {
    --primary: #e5282e;
    --primary-dark: #c41e23;
    --success: #28a745;
    --danger: #dc3545;
    --warning: #ffc107;
    --light: #f8f9fa;
    --dark: #343a40;
    --gray: #6c757d;
    --border: #dee2e6;
}

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
    background: #f5f5f5;
    min-height: 100vh;
    padding: 20px;
    color: var(--dark);
    line-height: 1.5;
}

.container {
    max-width: 1200px;
    margin: 0 auto;
    display: flex;
    flex-direction: column;
    gap: 20px;
}

.section {
    background: white;
    padding: 25px;
    border-radius: 12px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.08);
    position: relative;
    overflow: hidden;
}

.section::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 5px;
    background: linear-gradient(90deg, var(--primary), var(--primary-dark));
}

.header {
    text-align: center;
    margin-bottom: 20px;
    padding-bottom: 15px;
    border-bottom: 1px solid var(--border);
}

.header h1 {
    color: var(--primary);
    font-size: 1.8rem;
    margin-bottom: 8px;
}

.header p {
    color: var(--gray);
    font-size: 1rem;
}

/* Estilos do Conversor */
.converter-textarea {
    width: 100%;
    min-height: 300px;
    padding: 15px;
    box-sizing: border-box;
    border: 2px solid var(--border);
    border-radius: 8px;
    resize: vertical;
    font-family: 'Courier New', monospace;
    font-size: 14px;
    line-height: 1.4;
    margin-bottom: 15px;
    transition: border-color 0.3s;
}

.converter-textarea:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 0 3px rgba(229, 40, 46, 0.1);
}

.button-group {
    display: flex;
    gap: 12px;
    margin-top: 15px;
    justify-content: center;
    flex-wrap: wrap;
}

.btn {
    padding: 10px 20px;
    border: none;
    border-radius: 6px;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    min-width: 160px;
}

.btn-primary {
    background-color: var(--primary);
    color: white;
}

.btn-primary:hover {
    background-color: var(--primary-dark);
}

.btn-secondary {
    background: white;
    color: var(--dark);
    border: 1px solid var(--border);
}

.btn-secondary:hover {
    background: #f8f9fa;
}

.btn-small {
    padding: 6px 12px;
    font-size: 12px;
    min-width: auto;
    border-radius: 4px;
}

.btn-copy {
    background-color: #164029;
    color: white;
}

.btn-copy:hover {
    background-color: #0d261c;
}

.btn-success {
    background-color: var(--success);
    color: white;
}

.btn-success:hover {
    background-color: #218838;
}

/* Pr√©-visualiza√ß√£o compacta */
.preview-section {
    background: #f8f9fa;
    border-radius: 8px;
    padding: 15px;
    margin-top: 15px;
    border: 1px solid var(--border);
    max-height: 300px;
    overflow-y: auto;
}

.preview-item {
    display: flex;
    margin-bottom: 8px;
    padding-bottom: 8px;
    border-bottom: 1px dashed #ddd;
    font-size: 13px;
}

.preview-label {
    flex: 0 0 100px;
    font-weight: 600;
    color: var(--primary);
}

.preview-value {
    flex: 1;
    color: var(--dark);
    word-break: break-word;
}

.preview-value.empty {
    color: #999;
    font-style: italic;
}

/* √Årea de dica e bot√£o pequeno */
.tip-area {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 12px;
    padding: 10px 15px;
    background: #e8f0fe;
    border-radius: 6px;
    border: 1px solid #d2e3fc;
    font-size: 12px;
}

.tip-text {
    color: #1a5fb4;
    flex: 1;
}

/* Sistema de Inser√ß√£o */
.system-textarea {
    width: 100%;
    min-height: 120px;
    padding: 15px;
    border: 2px solid var(--border);
    border-radius: 8px;
    font-family: 'Courier New', monospace;
    font-size: 13px;
    line-height: 1.4;
    resize: vertical;
    transition: all 0.3s;
    background: white;
}

.system-textarea:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 0 3px rgba(229, 40, 46, 0.1);
}

.counter {
    background: #e8f0fe;
    padding: 10px;
    border-radius: 6px;
    margin: 12px 0;
    text-align: center;
    font-weight: bold;
    color: #1a5fb4;
    border: 1px solid #d2e3fc;
    font-size: 13px;
}

.status-box {
    margin-top: 15px;
    padding: 12px 15px;
    border-radius: 6px;
    display: none;
    animation: fadeIn 0.3s;
    font-size: 13px;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(-5px); }
    to { opacity: 1; transform: translateY(0); }
}

.status-success {
    background: #d4edda;
    color: #155724;
    border: 1px solid #c3e6cb;
}

.status-error {
    background: #f8d7da;
    color: #721c24;
    border: 1px solid #f5c6cb;
}

.status-info {
    background: #d1ecf1;
    color: #0c5460;
    border: 1px solid #bee5eb;
}

.status-warning {
    background: #fff3cd;
    color: #856404;
    border: 1px solid #ffeaa7;
}

.loading {
    display: none;
    text-align: center;
    margin: 15px 0;
}

.spinner {
    border: 3px solid rgba(0,0,0,0.1);
    border-radius: 50%;
    border-top: 3px solid var(--primary);
    width: 30px;
    height: 30px;
    animation: spin 1s linear infinite;
    margin: 0 auto 10px;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

.card {
    background: var(--light);
    border-radius: 8px;
    padding: 15px;
    margin-bottom: 15px;
    border-left: 3px solid var(--primary);
}

.card h3 {
    color: var(--primary);
    margin-bottom: 10px;
    font-size: 1.1rem;
    display: flex;
    align-items: center;
    gap: 8px;
}

h2 {
    color: var(--primary);
    border-bottom: 1px solid var(--border);
    padding-bottom: 10px;
    margin-bottom: 15px;
    font-size: 1.3rem;
}

.info-box {
    background: #fff3cd;
    border: 1px solid #ffeaa7;
    padding: 10px;
    border-radius: 6px;
    margin-bottom: 12px;
    font-size: 13px;
}

.finance-summary {
    background: #e8f5e9;
    border: 1px solid #c8e6c9;
    border-radius: 6px;
    padding: 10px;
    margin-bottom: 12px;
    font-size: 12px;
}

.finance-item {
    display: flex;
    justify-content: space-between;
    margin-bottom: 4px;
}

.finance-label {
    font-weight: 600;
}

.finance-value {
    font-weight: 600;
}

/* Responsividade */
@media (max-width: 768px) {
    .container {
        padding: 10px;
        gap: 15px;
    }
    
    .section {
        padding: 15px;
    }
    
    .button-group {
        flex-direction: column;
        gap: 8px;
    }
    
    .btn {
        width: 100%;
    }
    
    .preview-section {
        max-height: 250px;
    }
    
    .tip-area {
        flex-direction: column;
        gap: 8px;
        align-items: stretch;
    }
    
    .converter-textarea,
    .system-textarea {
        font-size: 12px;
        padding: 12px;
        min-height: 200px;
    }
}
</style>

<div class="container">
    <!-- Se√ß√£o do Conversor de Pedidos iFood -->
    <div class="section">
        <div class="header">
            <h1>üçî Processador de Pedidos iFood - VERS√ÉO CORRIGIDA</h1>
            <p>Suporte para Cacto de Ouro e Mundo Carol - Formato correto</p>
        </div>
        
        <div class="info-box">
            <strong>‚úÖ CORRE√á√ïES IMPLEMENTADAS:</strong><br />
            1. <strong>Loja Autom√°tica:</strong> Detecta Cacto de Ouro ou Mundo Carol<br />
            2. <strong>Desconto Simples:</strong> Apenas valor num√©rico (ex: 10,00)<br />
            3. <strong>Endere√ßo Corrigido:</strong> Funciona para ambas as lojas<br />
            4. <strong>Verifica√ß√£o:</strong> Confere valores recebidos do iFood<br />
            5. <strong>Hor√°rio Entrega:</strong> Formato "11:50 √†s 12:50" autom√°tico<br />
        </div>
        
        <textarea class="converter-textarea" id="inputData" placeholder="Cole aqui todo o conte√∫do do pedido do iFood..."></textarea>
        
        <div class="button-group">
            <button class="btn btn-primary" id="processBtn">üîÑ Processar Dados iFood</button>
            <button class="btn btn-secondary" id="clearConverterBtn">üóëÔ∏è Limpar</button>
        </div>
        
        <!-- Pr√©-visualiza√ß√£o compacta -->
        <div class="preview-section">
            <h2 style="margin-top: 0;">üìã Pr√©-visualiza√ß√£o do Pedido iFood</h2>
            <div id="previewArea" style="display: none;">
                <div id="previewContent"><!-- Conte√∫do ser√° gerado dinamicamente --></div>
                
                <div class="tip-area">
                    <div class="tip-text">üí° Os dados j√° foram copiados para a √°rea de inser√ß√£o abaixo.</div>
                    <button class="btn btn-copy btn-small" id="copyBtn">üìã Copiar</button>
                </div>
            </div>
            
            <div id="noPreview" style="text-align: center; padding: 20px; color: #999; font-size: 13px;">
                Processe os dados para ver a pr√©-visualiza√ß√£o aqui
            </div>
        </div>
    </div>
    
    <!-- Se√ß√£o do Sistema de Inser√ß√£o na Planilha -->
    <div class="section">
        <div class="header">
            <h1>üìã Sistema de Inser√ß√£o de Dados iFood</h1>
            <p>Inserir dados na planilha do Google Sheets (60 colunas)</p>
        </div>
        
        <div class="card">
            <h3>üìù Inserir Dados na Planilha</h3>
            <div style="margin-bottom: 15px;">
                <textarea class="system-textarea" id="dataInput" placeholder="Os dados processados acima s√£o copiados automaticamente aqui. 
Voc√™ tamb√©m pode colar manualmente dados do Excel/LibreOffice.
Cole UMA linha por vez, com os dados separados por TAB."></textarea>
            </div>
            
            <div class="counter" id="columnCounter">
                üìä Colunas detectadas: <span id="columnCount">0</span>
            </div>
        </div>
        
        <!-- Bot√µes de A√ß√£o -->
        <div class="button-group">
            <button class="btn btn-secondary" id="clearBtn">üóëÔ∏è Limpar Tudo</button>
            <button class="btn btn-primary" id="submitBtn">‚úÖ Confirmar Inser√ß√£o</button>
        </div>
        
        <!-- Loading -->
        <div class="loading" id="loadingSection">
            <div class="spinner"> </div>
            <p>Processando sua solicita√ß√£o...</p>
        </div>
        
        <!-- Status Messages -->
        <div class="status-box" id="statusBox"> </div>
    </div>
</div>

<script>
// ============================================
// CONFIGURA√á√ïES DO SISTEMA
// ============================================
const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycby_5VMpTyvPCSqA5TCDFUAx7wXQnybqonJX2-kBcFcS-Hlpx_1QKzF_d7XcIKC-0Uud/exec';
const CORRECT_PASSWORD = '562938';

let currentData = [];
let processedExcelLine = '';
let isSubmitting = false;

// ============================================
// FUN√á√ïES AUXILIARES
// ============================================

function parsePrice(priceStr) {
    if (!priceStr) return 0;
    const cleanStr = priceStr.replace('R$', '').replace(/\s/g, '').replace(/\./g, '').replace(',', '.');
    const result = parseFloat(cleanStr);
    return isNaN(result) ? 0 : result;
}

function formatPrice(price) {
    if (isNaN(price) || price === 0) return '0,00';
    return price.toFixed(2).replace('.', ',');
}

function getCurrentDate() {
    const now = new Date();
    const day = now.getDate().toString().padStart(2, '0');
    const month = (now.getMonth() + 1).toString().padStart(2, '0');
    const year = now.getFullYear();
    return `${day}/${month}/${year}`;
}

function getWeekdayName(dateStr) {
    const days = ['Domingo', 'Segunda-feira', 'Ter√ßa-feira', 'Quarta-feira', 'Quinta-feira', 'Sexta-feira', 'S√°bado'];
    const [day, month, year] = dateStr.split('/').map(Number);
    const date = new Date(year, month - 1, day);
    return days[date.getDay()];
}

// ============================================
// FUN√á√ÉO PARA AJUSTAR HOR√ÅRIO DE ENTREGA
// ============================================

function adjustDeliveryTime(deliveryTime) {
    if (!deliveryTime || deliveryTime.trim() === '') {
        return '';
    }
    
    try {
        // Remove espa√ßos e formata para HH:MM
        const time = deliveryTime.trim().replace(/\s/g, '');
        
        // Verifica se j√° est√° no formato "HH:MM √†s HH:MM"
        if (time.includes('√†s')) {
            return deliveryTime; // J√° est√° formatado
        }
        
        // Verifica se tem formato HH:MM
        if (!time.match(/^\d{1,2}:\d{2}$/)) {
            return deliveryTime;
        }
        
        // Divide horas e minutos
        const [hours, minutes] = time.split(':').map(Number);
        
        // Subtrai 1 hora
        let newHour = hours - 1;
        
        // Ajusta se passar da meia-noite
        if (newHour < 0) {
            newHour = 23; // Volta para 23:xx do dia anterior
        }
        
        // Formata a hora anterior com 2 d√≠gitos
        const previousHour = newHour.toString().padStart(2, '0');
        const formattedMinutes = minutes.toString().padStart(2, '0');
        const currentHour = hours.toString().padStart(2, '0');
        
        // Cria o formato "HH:MM √†s HH:MM"
        return `${previousHour}:${formattedMinutes} √†s ${currentHour}:${formattedMinutes}`;
        
    } catch (error) {
        console.error('Erro ao ajustar hor√°rio de entrega:', error);
        return deliveryTime;
    }
}

// ============================================
// FUN√á√ïES DE EXTRA√á√ÉO DE DADOS iFOOD - CORRIGIDAS
// ============================================

function extractOrderNumber(input) {
    if (!input) return '';
    const lines = input.split('\n').map(l => l.trim()).filter(l => l);
    return lines.length > 0 ? lines[0] : '';
}

function extractCustomerName(input) {
    if (!input) return '';
    const lines = input.split('\n').map(l => l.trim()).filter(l => l);
    return lines.length > 1 ? lines[1] : '';
}

function extractCustomerPhone(input) {
    if (!input) return '';
    
    const lines = input.split('\n').map(l => l.trim());
    
    // Procura por "Deixe seu contato Zap"
    for (let i = 0; i < lines.length; i++) {
        if (lines[i].includes('Deixe seu contato Zap') || lines[i].includes('para finalizar tudo')) {
            // Procura a linha "R$ 0,00" ou "R$0,00"
            for (let j = i + 1; j < Math.min(i + 5, lines.length); j++) {
                if (lines[j] === 'R$ 0,00' || lines[j] === 'R$0,00') {
                    // Pr√≥xima linha ap√≥s "R$ 0,00" √© o telefone/contato
                    if (j + 1 < lines.length && lines[j + 1].trim()) {
                        return lines[j + 1];
                    }
                }
            }
        }
    }
    
    return '';
}

function extractStoreName(input) {
    if (!input) return 'Loja iFood';
    
    const lines = input.split('\n').map(l => l.trim());
    
    // Procura por "Cacto de Ouro" OU "Mundo Carol"
    for (let i = 0; i < lines.length; i++) {
        const line = lines[i];
        
        if (line.includes('Cacto de Ouro')) {
            return 'Cacto de Ouro Kits e Presentes';
        }
        
        if (line.includes('Mundo Carol')) {
            return 'Mundo Carol Presentes';
        }
    }
    
    // Se n√£o encontrar nenhum dos dois, procura qualquer nome de loja
    for (let i = 0; i < lines.length; i++) {
        const line = lines[i];
        if (line && line.length > 5 && !line.includes('‚óè') && !line.includes('via iFood') && 
            !line.includes('Feito √†s') && !line.includes('Localizador') && 
            !line.match(/^\d+$/) && !line.includes('pedido')) {
            return line;
        }
    }
    
    return 'Loja iFood';
}

function extractOrderTime(input) {
    if (!input) return '';
    const timeMatch = input.match(/Feito √†s (\d{1,2}:\d{2})/);
    if (timeMatch) {
        return timeMatch[1] + ':00';
    }
    return '';
}

function extractDeliveryTime(input) {
    if (!input) return '';
    const deliveryMatch = input.match(/Entrega prevista:(\d{1,2}:\d{2})/);
    return deliveryMatch ? deliveryMatch[1] : '';
}

function extractGiftedInfo(input) {
    if (!input) return { phone: '' };
    
    // Procura pelo telefone do presenteado com ID (0800... ID: ...)
    const lines = input.split('\n').map(l => l.trim());
    for (const line of lines) {
        if (line.includes('0800') && line.includes('ID:')) {
            return { phone: line };
        }
    }
    
    return { phone: '' };
}

function extractAddress(input) {
    const result = {
        street: '',
        neighborhood: '',
        city: '',
        cep: '',
        complement: ''
    };
    
    if (!input) return result;
    
    const lines = input.split('\n').map(l => l.trim());
    
    // PROCURA ESPEC√çFICA PARA ENDERE√áO DO iFOOD
    for (let i = 0; i < lines.length; i++) {
        const line = lines[i];
        
        // Procura por linha com o caractere especial ‚óè (endere√ßo completo)
        if (line.includes('‚óè') && (line.includes('R.') || line.includes('Av.') || line.includes('Avenida') || line.includes('Rua'))) {
            const parts = line.split('‚óè');
            if (parts.length >= 2) {
                // Parte do endere√ßo (antes do ‚óè)
                const addressPart = parts[0].trim();
                // CEP (depois do ‚óè)
                result.cep = parts[1].trim();
                
                // Divide o endere√ßo por h√≠fen
                const addressParts = addressPart.split(' - ');
                if (addressParts.length >= 3) {
                    // Primeira parte: Rua e n√∫mero
                    result.street = addressParts[0].trim();
                    // Segunda parte: Bairro
                    result.neighborhood = addressParts[1].trim();
                    // Terceira parte: Cidade
                    result.city = addressParts[2].trim();
                } else {
                    // Se n√£o tiver 3 partes, coloca tudo na rua
                    result.street = addressPart;
                }
            }
            
            // Pr√≥xima linha PODE ser complemento (Apto 101, Bloco 3 Apto 303, etc)
            if (i + 1 < lines.length) {
                const nextLine = lines[i + 1].trim();
                // Verifica se √© um complemento v√°lido
                if (nextLine && 
                    !nextLine.includes('Entrega') && 
                    !nextLine.includes('Confirma√ß√£o') &&
                    !nextLine.includes('Copiar link') &&
                    !nextLine.includes('Compartilhar') &&
                    !nextLine.includes('Saiba mais') &&
                    !nextLine.match(/^\d{2}:\d{2}$/) && // N√£o √© hor√°rio
                    !nextLine.match(/^\d{2}\/\d{2}\/\d{4}$/) && // N√£o √© data
                    !nextLine.includes('Envie o link') &&
                    (nextLine.includes('Apto') || nextLine.includes('Bloco') || 
                     nextLine.includes('Casa') || nextLine.includes('Sala') ||
                     nextLine.includes('apto') || nextLine.includes('bloco') ||
                     nextLine.includes('casa') || nextLine.includes('sala'))) {
                    result.complement = nextLine;
                } else if (nextLine && nextLine.length > 0 && nextLine.length < 30) {
                    // Se for uma linha curta e n√£o for nenhuma das palavras-chave, assume como complemento
                    result.complement = nextLine;
                }
            }
            break;
        }
    }
    
    // Limpeza final dos dados
    result.street = result.street || '';
    result.complement = result.complement || '';
    result.neighborhood = result.neighborhood || '';
    result.city = result.city || '';
    result.cep = result.cep || '';
    
    return result;
}

function extractProducts(input) {
    if (!input) return { 
        productDescription: '', 
        productCodes: [], 
        totalPrice: 0, 
        originalPrice: 0, 
        totalDiscount: 0, 
        hasCard: 'N√£o',
        products: [] 
    };
    
    const lines = input.split('\n').map(l => l.trim());
    const products = [];
    let productTotalPrice = 0;
    let hasCard = 'N√£o';
    
    // Encontrar in√≠cio da se√ß√£o de produtos
    let startIndex = -1;
    for (let i = 0; i < lines.length; i++) {
        if (lines[i].includes('Itens no pedido')) {
            startIndex = i;
            break;
        }
    }
    
    if (startIndex === -1) {
        return { 
            productDescription: '', 
            productCodes: [], 
            totalPrice: 0, 
            originalPrice: 0, 
            totalDiscount: 0, 
            hasCard: 'N√£o',
            products: [] 
        };
    }
    
    // Coletar produtos
    for (let i = startIndex; i < lines.length; i++) {
        const line = lines[i];
        
        // Se encontrar "Sim, quero Cart√£o"
        if (line.includes('Sim, quero Cart√£o')) {
            hasCard = 'Sim';
        }
        
        // Se encontrar "Taxa de entrega", terminou os produtos
        if (line.includes('Taxa de entrega')) {
            break;
        }
        
        // Verificar se √© uma linha de produto (tem um h√≠fen com n√∫meros no final)
        if (line.includes('-') && !line.includes('R$') && line.length > 10) {
            const codeMatch = line.match(/- (\d+)$/);
            if (codeMatch) {
                const productCode = codeMatch[1];
                const productName = line.replace(`- ${productCode}`, '').trim();
                
                // Verificar quantidade (procura n√∫mero antes do produto)
                let quantity = 1;
                
                // Procurar pre√ßo nas pr√≥ximas linhas
                let productPrice = 0;
                for (let j = i + 1; j < Math.min(i + 5, lines.length); j++) {
                    if (lines[j].match(/^R\$\s*\d+[.,]\d{2}$/)) {
                        productPrice = parsePrice(lines[j]);
                        break;
                    }
                }
                
                // Verificar se tem quantidade espec√≠fica antes
                if (i > 0 && lines[i-1].trim() && lines[i-1].match(/^\d+$/)) {
                    quantity = parseInt(lines[i-1]);
                }
                
                products.push({
                    code: productCode,
                    name: productName,
                    quantity: quantity,
                    price: productPrice
                });
                
                productTotalPrice += (productPrice * quantity);
            }
        }
    }
    
    // PROCURAR DESCONTOS M√öLTIPLOS
    let totalDiscount = 0;
    let inDiscountSection = false;
    
    for (let i = 0; i < lines.length; i++) {
        const line = lines[i];
        
        if (line.includes('Valores cobrados da sua loja')) {
            inDiscountSection = true;
            continue;
        }
        
        if (inDiscountSection) {
            // Se encontrar linha vazia ou nova se√ß√£o, termina
            if (!line || line.includes('Pago via') || line.includes('Subtotal')) {
                break;
            }
            
            // Verifica se √© um valor negativo (desconto)
            if (line.startsWith('-R$') || line.startsWith('- R$') || line.startsWith('R$-') || 
                (line.match(/^R\$\s*-?\d+[.,]\d{2}$/) && line.includes('-'))) {
                const discountAmount = Math.abs(parsePrice(line));
                totalDiscount += discountAmount;
            }
        }
    }
    
    // Construir descri√ß√£o do produto no formato correto
    let productDescription = '';
    if (products.length > 0) {
        // Parte dos c√≥digos: (1x904 / 1x305)
        const codesPart = products.map(p => `${p.quantity}x${p.code}`).join(' / ');
        
        // Parte das descri√ß√µes: 1xcaf√© lembrancinha top... - 1xcaixa...
        const descriptionsPart = products.map(p => {
            const productNameLower = p.name.toLowerCase();
            return `${p.quantity}x${productNameLower}`;
        }).join(' - ');
        
        productDescription = `(${codesPart}) ${descriptionsPart}`;
    }
    
    const finalPrice = productTotalPrice - totalDiscount;
    
    return {
        productDescription: productDescription,
        productCodes: products.map(p => p.code),
        totalPrice: finalPrice,
        originalPrice: productTotalPrice,
        totalDiscount: totalDiscount,
        hasDiscount: totalDiscount > 0,
        hasCard: hasCard,
        products: products
    };
}

function extractShippingInfo(input) {
    if (!input) return { deliveryFee: 0, serviceFee: 0, totalShipping: 0 };
    
    const lines = input.split('\n').map(l => l.trim());
    let deliveryFee = 0;
    let serviceFee = 0;
    
    for (let i = 0; i < lines.length; i++) {
        const line = lines[i];
        
        if (line === 'Taxa de entrega') {
            if (i + 1 < lines.length && lines[i + 1].match(/^R\$\s*\d+[.,]\d{2}$/)) {
                deliveryFee = parsePrice(lines[i + 1]);
            }
        }
        
        if (line === 'Taxa de servi√ßo') {
            if (i + 1 < lines.length && lines[i + 1].match(/^R\$\s*\d+[.,]\d{2}$/)) {
                serviceFee = parsePrice(lines[i + 1]);
            }
        }
    }
    
    return {
        deliveryFee: deliveryFee,
        serviceFee: serviceFee,
        totalShipping: deliveryFee + serviceFee
    };
}

function extractTotalReceived(input) {
    if (!input) return 0;
    
    const lines = input.split('\n').map(l => l.trim());
    
    // Procura por "O iFood j√° recebeu este valor" e pega a linha anterior
    for (let i = 0; i < lines.length; i++) {
        if (lines[i].includes('O iFood j√° recebeu este valor')) {
            if (i > 0) {
                const valueLine = lines[i - 1];
                if (valueLine.startsWith('-R$') || valueLine.startsWith('- R$')) {
                    return Math.abs(parsePrice(valueLine));
                }
            }
        }
    }
    
    return 0;
}

// ============================================
// FUN√á√ÉO PRINCIPAL DE PROCESSAMENTO iFOOD - CORRIGIDA
// ============================================

function processData() {
    const input = document.getElementById('inputData').value;
    if (!input.trim()) {
        mostrarStatus('‚ùå Por favor, cole os dados do pedido do iFood primeiro.', 'error');
        return;
    }
    
    try {
        // Extrair todas as informa√ß√µes do iFood
        const orderNumber = extractOrderNumber(input);
        const customerName = extractCustomerName(input);
        const customerPhone = extractCustomerPhone(input);
        const storeName = extractStoreName(input); // <-- AGORA DETECTA AMBAS AS LOJAS
        const orderTime = extractOrderTime(input);
        const rawDeliveryTime = extractDeliveryTime(input);
        const formattedDeliveryTime = adjustDeliveryTime(rawDeliveryTime); // <-- FORMATA HOR√ÅRIO
        const giftedInfo = extractGiftedInfo(input);
        const address = extractAddress(input);
        const productInfo = extractProducts(input);
        const shippingInfo = extractShippingInfo(input);
        const totalReceived = extractTotalReceived(input);
        
        // Data atual
        const currentDate = getCurrentDate();
        const weekdayName = getWeekdayName(currentDate);
        const fullDateTime = `${currentDate} ${orderTime || '00:00:00'}`;
        const deliveryDate = `${currentDate} - ${weekdayName}`;
        
        // VALIDA√á√ÉO DOS C√ÅLCULOS
        const calculatedTotal = productInfo.totalPrice + shippingInfo.totalShipping;
        const validationOk = totalReceived > 0 && Math.abs(totalReceived - calculatedTotal) < 0.01;
        
        // Preparar resultado
        const result = {
            // Informa√ß√µes b√°sicas
            orderNumber: orderNumber,
            dateTime: fullDateTime,
            customerName: customerName,
            customerPhone: customerPhone,
            
            // Vendedor (AGORA DETECTA LOJA CORRETA)
            seller: `IFOOD - ${storeName}`,
            
            // Produto
            productDescription: productInfo.productDescription,
            productPrice: formatPrice(productInfo.totalPrice),
            productOriginalPrice: formatPrice(productInfo.originalPrice),
            productDiscount: formatPrice(productInfo.totalDiscount),
            
            // Entrega
            deliveryDate: deliveryDate,
            deliveryTime: formattedDeliveryTime, // <-- USA HOR√ÅRIO FORMATADO
            
            // Presenteado
            giftedPhone: giftedInfo.phone,
            
            // Endere√ßo
            street: address.street,
            complement: address.complement,
            neighborhood: address.neighborhood,
            city: address.city,
            cep: address.cep,
            
            // Valores
            shippingFee: formatPrice(shippingInfo.totalShipping),
            deliveryFee: formatPrice(shippingInfo.deliveryFee),
            serviceFee: formatPrice(shippingInfo.serviceFee),
            hasCard: productInfo.hasCard,
            
            // Valida√ß√£o
            totalReceived: formatPrice(totalReceived),
            calculatedTotal: formatPrice(calculatedTotal),
            validationOk: validationOk,
            
            // Sistema
            source: 'IFOOD',
            paymentMethod: 'IFOOD'
        };
        
        // Criar array com 60 colunas (padr√£o da sua planilha)
        const excelColumns = new Array(60).fill('');
        
        // Preencher colunas conforme mapeamento do iFood
        // COLUNA A: Data/Hora (dd/mm/aaaa hh:mm:ss)
        excelColumns[0] = result.dateTime;
        
        // COLUNA B: Nome do Cliente
        excelColumns[1] = result.customerName;
        
        // COLUNA C: Telefone do Cliente (ap√≥s "Deixe seu contato Zap")
        excelColumns[2] = result.customerPhone;
        
        // COLUNA D: Descri√ß√£o do Produto (formato: (1x904) 1xcaf√© lembrancinha...)
        excelColumns[3] = result.productDescription;
        
        // COLUNA E: Valor do Produto (com desconto aplicado)
        excelColumns[4] = result.productPrice;
        
        // COLUNA F: Frete (Taxa de entrega + Taxa de servi√ßo)
        excelColumns[5] = result.shippingFee;
        
        // COLUNA G: Vendedor (IFOOD - Nome da loja CORRETA)
        excelColumns[6] = result.seller;
        
        // COLUNA I: Nome do Presenteado (deixar vazio)
        excelColumns[8] = '';
        
        // COLUNA J: Telefone do Presenteado (0800... ID: ...)
        excelColumns[9] = result.giftedPhone;
        
        // ENDERE√áO
        excelColumns[10] = result.street;           // Coluna K: Rua e n√∫mero
        excelColumns[11] = result.complement;       // Coluna L: Complemento
        excelColumns[12] = result.neighborhood;     // Coluna M: Bairro
        excelColumns[13] = result.city;             // Coluna N: Cidade
        excelColumns[14] = result.cep;              // Coluna O: CEP
        
        // COLUNA P: Data de Entrega (data atual + dia da semana)
        excelColumns[15] = result.deliveryDate;
        
        // COLUNA Q: Hor√°rio de Entrega (FORMATADO: "11:50 √†s 12:50")
        excelColumns[16] = result.deliveryTime;
        
        // COLUNA R: Tem Cart√£o?
        excelColumns[17] = result.hasCard;
        
        // COLUNA S: Mensagem do Cart√£o (deixar vazio)
        excelColumns[18] = '';
        
        // COLUNA AG: M√©todo de Pagamento (sempre IFOOD)
        excelColumns[32] = result.paymentMethod;
        
        // COLUNA AU: Como nos encontrou? (IFOOD)
        excelColumns[46] = result.source;
        
        // COLUNA AY: Cupom/Informa√ß√µes extras - APENAS VALOR NUM√âRICO DO DESCONTO
        // ANTES: "DESCONTO iFood: R$ 10,00 | ID iFood: 61658883"
        // AGORA: APENAS "10,00" (apenas o valor num√©rico)
        excelColumns[50] = productInfo.totalDiscount > 0 ? result.productDiscount : '';
        
        // COLUNA BA: N√∫mero do Pedido
        excelColumns[52] = result.orderNumber;
        
        // Outras informa√ß√µes do iFood
        excelColumns[53] = result.deliveryFee;      // Taxa de entrega individual
        excelColumns[54] = result.serviceFee;       // Taxa de servi√ßo individual
        excelColumns[55] = result.productDiscount;  // Desconto TOTAL (soma de todos)
        
        // Gerar linha Excel
        processedExcelLine = excelColumns.join('\t');
        
        // Mostrar pr√©-visualiza√ß√£o
        showPreview(result, productInfo, shippingInfo, totalReceived, validationOk);
        
        // Copiar para o campo de inser√ß√£o
        document.getElementById('dataInput').value = processedExcelLine;
        processarDadosInput();
        
        const lojaDetectada = storeName.includes('Mundo Carol') ? 'Mundo Carol' : 'Cacto de Ouro';
        mostrarStatus(`‚úÖ Pedido #${orderNumber} processado! Loja: ${lojaDetectada}`, 'success');
        
    } catch (error) {
        console.error('Erro ao processar dados iFood:', error);
        mostrarStatus('‚ùå Erro ao processar os dados do iFood. Verifique o formato.', 'error');
    }
}

function showPreview(result, productInfo, shippingInfo, totalReceived, validationOk) {
    const previewContent = document.getElementById('previewContent');
    const previewArea = document.getElementById('previewArea');
    const noPreview = document.getElementById('noPreview');
    
    previewArea.style.display = 'block';
    noPreview.style.display = 'none';
    
    let previewHTML = '';
    
    // Resumo financeiro iFood
    previewHTML += `
        <div class="finance-summary">
            <div class="finance-item">
                <span class="finance-label">üçî Pedido iFood:</span>
                <span class="finance-value">#${result.orderNumber || 'N/A'}</span>
            </div>
            <div class="finance-item">
                <span class="finance-label">üè™ Loja:</span>
                <span class="finance-value">${result.seller}</span>
            </div>
            <div class="finance-item">
                <span class="finance-label">üë§ Cliente:</span>
                <span class="finance-value">${result.customerName || ''}</span>
            </div>
            <div class="finance-item">
                <span class="finance-label">üìû Telefone:</span>
                <span class="finance-value">${result.customerPhone || 'N√£o informado'}</span>
            </div>
            <div class="finance-item">
                <span class="finance-label">üõçÔ∏è Produto:</span>
                <span class="finance-value" style="font-size: 11px;">${result.productDescription || 'N/A'}</span>
            </div>
            <div class="finance-item">
                <span class="finance-label">üí∞ Valor Original:</span>
                <span class="finance-value">R$ ${result.productOriginalPrice}</span>
            </div>
    `;
    
    if (productInfo.totalDiscount > 0) {
        previewHTML += `
            <div class="finance-item" style="color: #28a745;">
                <span class="finance-label">üè∑Ô∏è Desconto TOTAL:</span>
                <span class="finance-value">- R$ ${result.productDiscount}</span>
            </div>
        `;
    }
    
    previewHTML += `
            <div class="finance-item" style="font-weight: bold;">
                <span class="finance-label">üíµ VALOR PRODUTO:</span>
                <span class="finance-value">R$ ${result.productPrice}</span>
            </div>
            <div class="finance-item">
                <span class="finance-label">üöö Taxa Entrega:</span>
                <span class="finance-value">R$ ${result.deliveryFee}</span>
            </div>
            <div class="finance-item">
                <span class="finance-label">üíº Taxa Servi√ßo:</span>
                <span class="finance-value">R$ ${result.serviceFee}</span>
            </div>
            <div class="finance-item" style="font-weight: bold; color: #e5282e;">
                <span class="finance-label">üì¶ FRETE TOTAL:</span>
                <span class="finance-value">R$ ${result.shippingFee}</span>
            </div>
            <div class="finance-item" style="font-weight: bold; border-top: 1px solid #c8e6c9; padding-top: 5px; margin-top: 5px;">
                <span class="finance-label">üìÖ Data Pedido:</span>
                <span class="finance-value">${result.dateTime}</span>
            </div>
            <div class="finance-item" style="font-weight: bold;">
                <span class="finance-label">üìÖ Data Entrega:</span>
                <span class="finance-value">${result.deliveryDate}</span>
            </div>
    `;
    
    // Verifica√ß√£o de valores
    if (totalReceived > 0) {
        previewHTML += `
            <div class="finance-item" style="background: ${validationOk ? '#d4edda' : '#fff3cd'}; padding: 3px; border-radius: 3px; margin-top: 5px;">
                <span class="finance-label">${validationOk ? '‚úÖ' : '‚ö†Ô∏è'} Confer√™ncia:</span>
                <span class="finance-value">R$ ${result.calculatedTotal} ${validationOk ? '‚úì' : '(verificar)'}</span>
            </div>
        `;
    }
    
    previewHTML += `</div>`;
    
    // ENDERE√áO
    if (result.street || result.neighborhood || result.city) {
        previewHTML += `
            <div class="preview-item">
                <div class="preview-label">üè† Endere√ßo:</div>
                <div class="preview-value">
                    <strong>${result.street || ''}</strong>
                    ${result.complement ? `<br><small style="color: #666;">${result.complement}</small>` : ''}
                </div>
            </div>
            <div class="preview-item">
                <div class="preview-label">üìç Bairro/Cidade:</div>
                <div class="preview-value">
                    ${result.neighborhood || ''} ${result.city ? `- ${result.city}` : ''}
                    ${result.cep ? `<br><small style="color: #666;">CEP: ${result.cep}</small>` : ''}
                </div>
            </div>
        `;
    } else {
        previewHTML += `
            <div class="preview-item">
                <div class="preview-label">üè† Endere√ßo:</div>
                <div class="preview-value" style="color: #dc3545; font-style: italic;">
                    N√£o encontrado no pedido
                </div>
            </div>
        `;
    }
    
    // Entrega - AGORA MOSTRA HOR√ÅRIO FORMATADO
    if (result.deliveryTime) {
        previewHTML += `
            <div class="preview-item">
                <div class="preview-label">‚è∞ Hor√°rio Entrega:</div>
                <div class="preview-value"><strong>${result.deliveryTime}</strong></div>
            </div>
        `;
    }
    
    // Presenteado
    if (result.giftedPhone) {
        previewHTML += `
            <div class="preview-item">
                <div class="preview-label">üìû Presenteado:</div>
                <div class="preview-value" style="font-size: 11px;">${result.giftedPhone}</div>
            </div>
        `;
    }
    
    // Cart√£o
    previewHTML += `
        <div class="preview-item">
            <div class="preview-label">üíå Tem Cart√£o?:</div>
            <div class="preview-value">${result.hasCard}</div>
        </div>
    `;
    
    // DESCONTO (novo formato)
    previewHTML += `
        <div class="preview-item">
            <div class="preview-label">üí∞ Desconto (Coluna AY):</div>
            <div class="preview-value">${result.productDiscount || '0,00'}</div>
        </div>
    `;
    
    // Pagamento
    previewHTML += `
        <div class="preview-item" style="border-bottom: none;">
            <div class="preview-label">üí≥ Pagamento:</div>
            <div class="preview-value">${result.paymentMethod}</div>
        </div>
    `;
    
    previewContent.innerHTML = previewHTML;
}

// ============================================
// FUN√á√ïES DE C√ìPIA, INSER√á√ÉO E UTILIT√ÅRIOS
// ============================================

function copyToClipboard() {
    if (!processedExcelLine) {
        mostrarStatus('‚ùå Nenhum dado para copiar. Processe os dados primeiro.', 'error');
        return;
    }
    
    const tempTextArea = document.createElement('textarea');
    tempTextArea.value = processedExcelLine;
    document.body.appendChild(tempTextArea);
    tempTextArea.select();
    tempTextArea.setSelectionRange(0, 99999);
    
    try {
        const successful = document.execCommand('copy');
        const copyBtn = document.getElementById('copyBtn');
        const originalText = copyBtn.innerHTML;
        copyBtn.innerHTML = '‚úÖ Copiado!';
        copyBtn.style.backgroundColor = '#28a745';
        
        setTimeout(() => {
            copyBtn.innerHTML = originalText;
            copyBtn.style.backgroundColor = '';
        }, 2000);
        
        mostrarStatus('‚úÖ Copiado para a √°rea de transfer√™ncia!', 'success');
        
    } catch (err) {
        mostrarStatus('‚ùå Erro ao copiar: ' + err, 'error');
    } finally {
        document.body.removeChild(tempTextArea);
    }
}

function processarDadosInput() {
    const input = document.getElementById('dataInput');
    const data = input.value.trim();
    const counter = document.getElementById('columnCount');
    const counterBox = document.getElementById('columnCounter');
    
    if (!data) {
        counter.textContent = '0';
        counterBox.style.background = '#e8f0fe';
        currentData = [];
        return;
    }
    
    const lines = data.split('\n');
    const firstLine = lines[0];
    const columns = firstLine.split('\t').map(col => col.trim());
    
    counter.textContent = columns.length;
    
    if (columns.length < 5) {
        counterBox.style.background = '#f8d7da';
        counterBox.style.color = '#721c24';
        counterBox.style.borderColor = '#f5c6cb';
    } else if (columns.length >= 55) {
        counterBox.style.background = '#d4edda';
        counterBox.style.color = '#155724';
        counterBox.style.borderColor = '#c3e6cb';
    } else if (columns.length >= 45) {
        counterBox.style.background = '#fff3cd';
        counterBox.style.color = '#856404';
        counterBox.style.borderColor = '#ffeaa7';
    } else {
        counterBox.style.background = '#f8d7da';
        counterBox.style.color = '#721c24';
        counterBox.style.borderColor = '#f5c6cb';
    }
    
    currentData = columns;
    
    if (lines.length > 1) {
        mostrarStatus(`‚ö†Ô∏è Apenas a primeira linha ser√° processada (${lines.length-1} linha(s) ignorada(s))`, 'info');
    }
}

async function confirmarInsercao() {
    if (isSubmitting) return;
    
    if (currentData.length === 0) {
        mostrarStatus('‚ùå Nenhum dado para inserir!', 'error');
        return;
    }
    
    if (currentData.length < 55) {
        mostrarStatus('‚ö†Ô∏è O n√∫mero de colunas parece menor que o esperado (60 colunas). Verifique os dados.', 'warning');
        if (!confirm('O n√∫mero de colunas parece incompleto. Deseja continuar mesmo assim?')) {
            return;
        }
    }
    
    const submitBtn = document.getElementById('submitBtn');
    const loadingSection = document.getElementById('loadingSection');
    
    submitBtn.disabled = true;
    isSubmitting = true;
    loadingSection.style.display = 'block';
    
    mostrarStatus('‚è≥ Enviando dados para a planilha...', 'info');
    
    try {
        const result = await enviarDadosViaJSONP();
        
        if (result.success) {
            submitBtn.innerHTML = '‚úÖ CONCLU√çDO';
            submitBtn.classList.remove('btn-primary');
            submitBtn.classList.add('btn-success');
            
            mostrarStatus(`‚úÖ ${result.message}`, 'success');
            
            setTimeout(() => {
                limparFormulario();
                
                setTimeout(() => {
                    submitBtn.innerHTML = '‚úÖ Confirmar Inser√ß√£o';
                    submitBtn.classList.remove('btn-success');
                    submitBtn.classList.add('btn-primary');
                    submitBtn.disabled = false;
                    isSubmitting = false;
                }, 1000);
                
            }, 2000);
            
        } else {
            throw new Error(result.message || result.error);
        }
        
    } catch (error) {
        console.error('‚ùå Erro no envio:', error);
        
        mostrarStatus('‚ö†Ô∏è Usando m√©todo de backup...', 'info');
        
        try {
            fallbackSalvarLocal();
            
        } catch (altError) {
            console.error('‚ùå Erro alternativo:', altError);
            mostrarStatus(`‚ùå Falha: ${altError.message || 'Erro de conex√£o'}`, 'error');
            submitBtn.disabled = false;
            isSubmitting = false;
        }
        
    } finally {
        loadingSection.style.display = 'none';
    }
}

function enviarDadosViaJSONP() {
    return new Promise((resolve, reject) => {
        try {
            if (!currentData || currentData.length === 0) {
                reject(new Error('Nenhum dado para enviar'));
                return;
            }
            
            const callbackName = 'jsonp_callback_' + Date.now() + '_' + Math.random().toString(36).substr(2);
            const script = document.createElement('script');
            
            const dadosString = JSON.stringify(currentData);
            const dadosEncoded = encodeURIComponent(dadosString);
            
            const url = `${WEB_APP_URL}?callback=${callbackName}&action=inserir_pedido&senha=${CORRECT_PASSWORD}&dados=${dadosEncoded}`;
            
            script.src = url;
            script.type = 'text/javascript';
            
            window[callbackName] = function(response) {
                delete window[callbackName];
                if (script.parentNode) {
                    script.parentNode.removeChild(script);
                }
                
                console.log('üì¶ Resposta JSONP:', response);
                
                if (response && response.success) {
                    resolve({
                        success: true,
                        message: response.message || 'Dados enviados via JSONP'
                    });
                } else {
                    reject(new Error(response.message || 'Erro na resposta JSONP'));
                }
            };
            
            document.body.appendChild(script);
            
            setTimeout(() => {
                if (window[callbackName]) {
                    delete window[callbackName];
                    if (script.parentNode) {
                        script.parentNode.removeChild(script);
                    }
                    reject(new Error('Timeout na requisi√ß√£o JSONP'));
                }
            }, 15000);
            
        } catch (error) {
            console.error('‚ùå Erro no JSONP:', error);
            reject(error);
        }
    });
}

function fallbackSalvarLocal() {
    if (!processedExcelLine) {
        mostrarStatus('‚ùå Nenhum dado para salvar', 'error');
        return;
    }
    
    const pedidoKey = 'pedido_ifood_backup_' + new Date().getTime();
    const pedidoData = {
        dados: currentData,
        linha: processedExcelLine,
        timestamp: new Date().toISOString(),
        origem: 'IFOOD'
    };
    
    localStorage.setItem(pedidoKey, JSON.stringify(pedidoData));
    
    const areaTexto = document.createElement('textarea');
    areaTexto.value = processedExcelLine;
    areaTexto.style.position = 'fixed';
    areaTexto.style.left = '0';
    areaTexto.style.top = '0';
    areaTexto.style.opacity = '0';
    document.body.appendChild(areaTexto);
    areaTexto.focus();
    areaTexto.select();
    
    mostrarStatus('üìã Dados do iFood salvos localmente. Pressione Ctrl+C para copiar e cole na planilha manualmente.', 'warning');
    
    setTimeout(() => {
        document.body.removeChild(areaTexto);
    }, 5000);
    
    return {
        success: true,
        message: 'Dados salvos localmente para c√≥pia manual'
    };
}

function mostrarStatus(message, type = 'info') {
    const statusBox = document.getElementById('statusBox');
    
    statusBox.className = 'status-box';
    
    if (type === 'success') {
        statusBox.classList.add('status-success');
    } else if (type === 'error') {
        statusBox.classList.add('status-error');
    } else if (type === 'warning') {
        statusBox.classList.add('status-warning');
    } else {
        statusBox.classList.add('status-info');
    }
    
    statusBox.innerHTML = message;
    statusBox.style.display = 'block';
    
    if (type !== 'error') {
        setTimeout(() => {
            statusBox.style.display = 'none';
        }, type === 'success' ? 5000 : 3000);
    }
}

function limparFormulario() {
    document.getElementById('dataInput').value = '';
    document.getElementById('columnCount').textContent = '0';
    document.getElementById('columnCounter').style.background = '#e8f0fe';
    currentData = [];
}

function clearConverterFields() {
    document.getElementById('inputData').value = '';
    document.getElementById('previewArea').style.display = 'none';
    document.getElementById('noPreview').style.display = 'block';
    document.getElementById('dataInput').value = '';
    document.getElementById('columnCount').textContent = '0';
    document.getElementById('columnCounter').style.background = '#e8f0fe';
    
    mostrarStatus('üóëÔ∏è Conversor limpo!', 'info');
}

function limparTudo() {
    clearConverterFields();
    limparFormulario();
}

// ============================================
// INICIALIZA√á√ÉO
// ============================================
document.addEventListener('DOMContentLoaded', function() {
    console.log('üöÄ Sistema iFood VERS√ÉO FINAL CORRIGIDA inicializado');
    
    document.getElementById('processBtn').addEventListener('click', processData);
    document.getElementById('copyBtn').addEventListener('click', copyToClipboard);
    document.getElementById('clearConverterBtn').addEventListener('click', clearConverterFields);
    document.getElementById('clearBtn').addEventListener('click', limparTudo);
    document.getElementById('submitBtn').addEventListener('click', confirmarInsercao);
    
    document.getElementById('dataInput').addEventListener('input', processarDadosInput);
    
    document.getElementById('inputData').addEventListener('keypress', function(e) {
        if (e.ctrlKey && e.key === 'Enter') {
            processData();
        }
    });
    
    setTimeout(() => {
        mostrarStatus('üçî Suporte para Cacto de Ouro e Mundo Carol. Desconto apenas valor num√©rico.', 'info');
    }, 500);
    
    document.getElementById('inputData').focus();
});
</script>
